<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>湘江战役 — 红军生存率测试（模拟）</title>
  <style>
    :root{font-family: "PingFang SC", "Microsoft Yahei", Arial, sans-serif}
    body{margin:0;padding:16px;background:#0f1724;color:#eef2ff;display:flex;align-items:flex-start;justify-content:center;min-height:100vh}
    .card{width:100%;max-width:600px;background:#0b1220;border-radius:12px;padding:16px;box-shadow:0 8px 30px rgba(0,0,0,0.6)}
    h1{margin:6px 0 8px;font-size:18px;text-align:center;color:#fff}
    p.lead{margin:6px 0 12px;color:#cbd5e1;font-size:13px;text-align:center}
    .note{background:#071022;padding:10px;border-radius:8px;color:#aab8d6;font-size:13px;margin-bottom:12px}
    .question{background:linear-gradient(180deg,#07112a,#071027);padding:12px;border-radius:10px;margin-bottom:12px;border:1px solid rgba(255,255,255,0.03)}
    .qtitle{font-weight:700;color:#e6eef8;margin-bottom:8px}
    .opts{display:flex;flex-direction:column;gap:8px}
    .optbtn{background:#061127;color:#dbe9ff;border-radius:10px;padding:10px;text-align:left;border:1px solid rgba(255,255,255,0.03);cursor:pointer;font-size:15px}
    .optbtn.selected{outline:2px solid rgba(99,179,237,0.18);box-shadow:0 6px 18px rgba(30,90,160,0.06)}
    .controls{display:flex;gap:8px;margin-top:10px}
    .btn{flex:1;padding:10px;border-radius:10px;border:none;cursor:pointer;font-weight:700}
    .btn.primary{background:#2b86ff;color:#fff}
    .btn.ghost{background:transparent;color:#9fb7d8;border:1px solid rgba(255,255,255,0.04)}
    .result{margin-top:14px;padding:12px;border-radius:10px;background:linear-gradient(180deg,#071126,#06111c);border:1px solid rgba(255,255,255,0.03)}
    .percent{font-size:30px;font-weight:800;color:#ffefc2;margin-top:6px}
    .breakdown{margin-top:10px;font-size:14px;color:#d0d9ea}
    .small{font-size:12px;color:#98a9c7;margin-top:8px}
    .detail-list{margin-top:10px;color:#cbd7ea}
    @media (max-width:420px){body{padding:10px}.card{padding:12px}.percent{font-size:24px}}
  </style>
</head>
<body>
  <div class="card" role="application" aria-labelledby="title">
    <h1 id="title">湘江战役 — 红军生存率测试（模拟）</h1>
    <p class="lead">按你在视频里那套题做出的选择，计算一个模拟“存活率”。仅作教育与讨论用途，不作为历史结论。</p>

    <div class="note">提示：请逐题选择最符合“你在战场上”的决策。每项选择会影响最终存活率（0–50%）。</div>

    <div id="quiz"></div>

    <div class="controls" style="margin-top:12px">
      <button id="prevBtn" class="btn ghost" style="display:none">上一步</button>
      <button id="nextBtn" class="btn primary">下一题</button>
    </div>

    <div id="resultArea" class="result" style="display:none" aria-live="polite">
      <div><strong>你的模拟存活率：</strong></div>
      <div class="percent" id="percentText">--%</div>
      <div id="resultText" class="breakdown"></div>
      <div class="small">注：基于简化权重模型与你的视频题库，结果为模拟值。</div>
      <div style="display:flex;gap:8px;margin-top:12px">
        <button id="retryBtn" class="btn ghost">再来一次</button>
        <button id="detailsBtn" class="btn primary">查看选择明细</button>
      </div>
      <div id="detailBox" class="detail-list" style="display:none"></div>
    </div>
  </div>

<script>
  // 题库（按视频识别的六题）
  const questions = [
    {
      title: "Q1｜你在长征前体能储备属于？",
      opts: [
        { text: "A. 体力很好，平时能背几十斤走一天", weight: 8 },
        { text: "B. 体力一般，走久了会累", weight: 3 },
        { text: "C. 身体偏弱，但意志力还行", weight: 0 }
      ]
    },
    {
      title: "Q2｜湘江战役爆发，你所在部队选择突围方向，你会支持？",
      opts: [
        { text: "A. 直接强渡湘江", weight: 10 },
        { text: "B. 迂回南线", weight: 5 },
        { text: "C. 原地固守拖延敌军", weight: -6 }
      ]
    },
    {
      title: "Q3｜敌机轰炸时，你会做什么？",
      opts: [
        { text: "A. 迅速撤开", weight: 6 },
        { text: "B. 养伤的战体", weight: 2 },
        { text: "C. 躲在树干下或河边", weight: -8 }
      ]
    },
    {
      title: "Q4｜粮食短缺时，你会：",
      opts: [
        { text: "A. 把口粮让给伤员", weight: -6 },
        { text: "B. 自己留一点保证战斗力", weight: 2 },
        { text: "C. 交给组织统一分配", weight: 6 }
      ]
    },
    {
      title: "Q5｜部队连续行军 40 公里，你扛不住了，你会：",
      opts: [
        { text: "A. 咬牙跟随队伍", weight: 6 },
        { text: "B. 休息几分钟后追赶", weight: 2 },
        { text: "C. 完全停下休息", weight: -10 }
      ]
    },
    {
      title: "Q6｜你看见战友负伤无法行走，你会：",
      opts: [
        { text: "A. 背着他一起走", weight: -8 },
        { text: "B. 把武器和口粮分给他", weight: -2 },
        { text: "C. 报告组织找地方处理", weight: 6 }
      ]
    }
  ];

  // 基础参数：基础概率（保守起点）
  const basePercent = 10; // 起始值，最后会被限制到 0-50 并四舍五入
  let currentIndex = 0;
  const answers = new Array(questions.length).fill(null);

  const quizDiv = document.getElementById('quiz');
  const prevBtn = document.getElementById('prevBtn');
  const nextBtn = document.getElementById('nextBtn');
  const resultArea = document.getElementById('resultArea');
  const percentText = document.getElementById('percentText');
  const resultText = document.getElementById('resultText');
  const retryBtn = document.getElementById('retryBtn');
  const detailsBtn = document.getElementById('detailsBtn');
  const detailBox = document.getElementById('detailBox');

  function renderQuestion(i){
    const q = questions[i];
    quizDiv.innerHTML = '';
    const container = document.createElement('div');
    container.className = 'question';

    const title = document.createElement('div');
    title.className = 'qtitle';
    title.innerText = q.title;
    container.appendChild(title);

    const opts = document.createElement('div');
    opts.className = 'opts';
    q.opts.forEach((o, idx) => {
      const b = document.createElement('button');
      b.className = 'optbtn';
      b.innerText = o.text;
      b.onclick = () => {
        answers[i] = idx;
        // 更新视觉
        Array.from(opts.children).forEach((c,ii) => c.classList.toggle('selected', ii === idx));
      };
      if (answers[i] === idx) b.classList.add('selected');
      opts.appendChild(b);
    });

    container.appendChild(opts);

    const foot = document.createElement('div');
    foot.className = 'small';
    foot.style.color = '#9fb7d8';
    foot.style.marginTop = '8px';
    foot.innerText = `第 ${i+1} / ${questions.length} 题`;
    container.appendChild(foot);

    quizDiv.appendChild(container);

    prevBtn.style.display = i === 0 ? 'none' : 'inline-flex';
    nextBtn.innerText = i === questions.length - 1 ? '提交并查看结果' : '下一题';
  }

  function computePercent(){
    // 累加权重
    let total = basePercent;
    const details = [];
    for (let i=0;i<questions.length;i++){
      const a = answers[i];
      let w = 0;
      let chosen = '未选择（视作被动）';
      if (typeof a === 'number' && a !== null){
        w = questions[i].opts[a].weight;
        chosen = questions[i].opts[a].text;
      } else {
        // 未选：视为消极处理，轻微扣分
        w = -4;
      }
      total += w;
      details.push({ q: questions[i].title, choice: chosen, weight: w });
    }
    // 限制到 0 - 50
    if (total < 0) total = 0;
    if (total > 50) total = 50;
    // 保留整数
    total = Math.round(total);
    return { percent: total, details };
  }

  function showResult(){
    const r = computePercent();
    percentText.innerText = r.percent + '%';

    // 分档并使用你提供的逐字文本
    let text = '';
    if (r.percent >= 40){
      text = "<strong>结果 A | 你的湘江战役生存率：48％</strong><br>"
           + "你属于：意志坚定型战士<br>"
           + "你体能不错，决策较冷静，懂得跟着大部队行动。<br>"
           + "虽然湘江战役极其惨烈，但你有一定概率活下来。<br>"
           + "但这段路你依然会目睹无数战友牺牲。";
      // 为了和视频示例接近：若计算值>48则仍显示计算值，但文案固定写 48%
      // 显示的百分比仍为计算值
    } else if (r.percent >= 20){
      text = "<strong>结果 B | 你的生存率：27%</strong><br>"
           + "你属于：普通红军战士<br>"
           + "你会做一些本能决策，但战场混乱可能让你付出代价。<br>"
           + "在湘江战役这样的高强度交战中，你的存活完全看命。<br>"
           + "但你会见证历史最残酷的一段。";
    } else {
      text = "<strong>结果 C | 你的生存率：9%</strong><br>"
           + "你属于：赤诚但命悬一线的战士<br>"
           + "你做了很多“善良但危险”的选择：<br>"
           + "牺牲口粮、背负同伴、停下休息…⋯这些在战场上几乎等于自杀。<br>"
           + "但你身上有最朴素的善意。";
    }

    resultText.innerHTML = text;
    resultArea.style.display = 'block';
    quizDiv.style.display = 'none';
    prevBtn.style.display = 'none';
    nextBtn.style.display = 'none';
    detailBox.style.display = 'none';
  }

  prevBtn.addEventListener('click', () => {
    if (currentIndex > 0){
      currentIndex--;
      renderQuestion(currentIndex);
    }
  });

  nextBtn.addEventListener('click', () => {
    // 允许未选但警告（除非最后一题）
    if (answers[currentIndex] === null){
      if (currentIndex < questions.length - 1){
        if (!confirm('当前题未选择，系统将视为被动处理并扣分，是否继续？')) return;
      }
    }
    if (currentIndex < questions.length - 1){
      currentIndex++;
      renderQuestion(currentIndex);
    } else {
      showResult();
    }
  });

  retryBtn.addEventListener('click', () => {
    for (let i=0;i<answers.length;i++) answers[i] = null;
    currentIndex = 0;
    quizDiv.style.display = 'block';
    resultArea.style.display = 'none';
    renderQuestion(currentIndex);
  });

  detailsBtn.addEventListener('click', () => {
    const r = computePercent();
    let html = '<strong>选择明细：</strong><ol>';
    r.details.forEach(d => {
      html += `<li style="margin:6px 0"><div style="font-weight:700;color:#dbe9ff">${d.q}</div><div style="color:#cbd7ea">${d.choice}</div><div style="color:#9fb7d8">影响： ${d.weight >= 0 ? '+'+d.weight : d.weight} %</div></li>`;
    });
    html += `</ol><div style="margin-top:8px;color:#dbe9ff"><strong>合计（含基础 ${basePercent}%）：</strong> ${r.percent}%（已做上下限约束）</div>`;
    detailBox.innerHTML = html;
    detailBox.style.display = 'block';
  });

  // 初始渲染
  renderQuestion(currentIndex);
</script>
</body>
</html>
